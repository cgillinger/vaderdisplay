/* 
 * WeatherEffects CSS f√∂r Flask Weather Dashboard
 * FAS 2: CSS-styling och animationer
 * 
 * OPTIMERAD F√ñR: LP156WH4 (1366√ó768) + Pi5 GPU + Chromium kiosk-l√§ge
 * BASERAD P√Ö: MagicMirror MMM-WeatherEffects CSS
 * PRESTANDA: Smooth 60fps animationer f√∂r Pi5 + GPU-acceleration
 * KOMPATIBILITET: Z-index och layout-kompatibel med befintlig glassmorphism
 * 
 * üåßÔ∏è ENHANCED: F√∂rb√§ttrade regndroppar f√∂r b√§ttre synlighet p√• LP156WH4
 */

/* === BASE WRAPPER (MM-kompatibel) === */

.weather-effect-wrapper {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    pointer-events: none !important;
    z-index: 99999999 !important; /* √ñver alla dashboard-element */
    overflow: hidden !important;
    
    /* Smooth transitions */
    transition: opacity 1000ms ease-in-out;
    
    /* GPU-acceleration f√∂r Pi5 */
    transform: translateZ(0);
    will-change: opacity;
    
    /* S√§kerst√§ll att effekter inte p√•verkar layout */
    display: block;
    contain: layout style paint;
}

/* === REGN-EFFEKTER (LP156WH4 OPTIMERADE - F√ñRB√ÑTTRAD SYNLIGHET) === */

.rain-particle {
    position: absolute !important;
    width: 4px; /* üåßÔ∏è F√ñRB√ÑTTRAT: Bredare fr√•n 2px till 4px */
    height: 18px; /* üåßÔ∏è F√ñRB√ÑTTRAT: L√§ngre fr√•n 12px till 18px */
    background: linear-gradient(to bottom, 
        rgba(0, 170, 255, 0.95) 0%, /* üåßÔ∏è F√ñRB√ÑTTRAT: H√∂gre opacitet */
        rgba(0, 170, 255, 0.85) 50%, /* üåßÔ∏è F√ñRB√ÑTTRAT: Mer synlig mitt */
        rgba(0, 170, 255, 0.3) 100% /* üåßÔ∏è F√ñRB√ÑTTRAT: Mjukare fade */
    );
    opacity: 0.9; /* üåßÔ∏è F√ñRB√ÑTTRAT: H√∂jd fr√•n 0.8 till 0.9 */
    border-radius: 0 0 50% 50%; /* Droppe-form */
    
    /* üåßÔ∏è F√ñRB√ÑTTRAT: Glow-effekt f√∂r b√§ttre definition */
    box-shadow: 
        0 0 2px rgba(0, 170, 255, 0.6),
        0 0 4px rgba(0, 170, 255, 0.3);
    
    /* GPU-acceleration */
    transform: translateZ(0);
    will-change: transform, opacity;
    
    /* Pi5-optimerad animation */
    animation: rain-fall linear infinite;
    
    /* üåßÔ∏è F√ñRB√ÑTTRAT: Starkare kontrast f√∂r LP156WH4 LED LCD */
    filter: brightness(1.15) contrast(1.1) saturate(1.2);
    
    /* F√∂rhindra text-selection */
    user-select: none;
    pointer-events: none;
}

/* Vindp√•verkade regn-partiklar */
.rain-particle.wind-left {
    transform: skewX(-15deg) translateZ(0);
}

.rain-particle.wind-right {
    transform: skewX(15deg) translateZ(0);
}

/* Regn-animation optimerad f√∂r LP156WH4 + Pi5 */
@keyframes rain-fall {
    0% {
        transform: translateY(-20px) translateZ(0);
        opacity: 0;
    }
    
    10% {
        opacity: 0.9; /* üåßÔ∏è F√ñRB√ÑTTRAT: H√∂gre start-opacitet */
    }
    
    90% {
        opacity: 0.9; /* üåßÔ∏è F√ñRB√ÑTTRAT: Beh√•ller synlighet l√§ngre */
    }
    
    100% {
        transform: translateY(100vh) translateZ(0);
        opacity: 0;
    }
}

/* Vindp√•verkad regn-animation */
@keyframes rain-fall-wind-left {
    0% {
        transform: translateY(-20px) translateX(0) skewX(-15deg) translateZ(0);
        opacity: 0;
    }
    
    10% {
        opacity: 0.9; /* üåßÔ∏è F√ñRB√ÑTTRAT: H√∂gre opacitet */
    }
    
    90% {
        opacity: 0.9; /* üåßÔ∏è F√ñRB√ÑTTRAT: Beh√•ller synlighet l√§ngre */
    }
    
    100% {
        transform: translateY(100vh) translateX(-50px) skewX(-15deg) translateZ(0);
        opacity: 0;
    }
}

@keyframes rain-fall-wind-right {
    0% {
        transform: translateY(-20px) translateX(0) skewX(15deg) translateZ(0);
        opacity: 0;
    }
    
    10% {
        opacity: 0.9; /* üåßÔ∏è F√ñRB√ÑTTRAT: H√∂gre opacitet */
    }
    
    90% {
        opacity: 0.9; /* üåßÔ∏è F√ñRB√ÑTTRAT: Beh√•ller synlighet l√§ngre */
    }
    
    100% {
        transform: translateY(100vh) translateX(50px) skewX(15deg) translateZ(0);
        opacity: 0;
    }
}

/* === SN√ñ-EFFEKTER (LP156WH4 OPTIMERADE) === */

.snow-particle {
    position: absolute !important;
    color: #ffffff;
    font-family: 'Segoe UI', 'Arial', sans-serif;
    font-weight: 400;
    opacity: 0.85;
    
    /* GPU-acceleration */
    transform: translateZ(0);
    will-change: transform, opacity;
    
    /* Pi5-optimerad animation */
    animation: snow-fall linear infinite;
    
    /* F√∂rb√§ttrad kontrast f√∂r LP156WH4 LED LCD */
    text-shadow: 
        0 0 3px rgba(255, 255, 255, 0.8),
        0 0 6px rgba(255, 255, 255, 0.4);
    filter: brightness(1.1) contrast(1.1);
    
    /* F√∂rhindra text-selection */
    user-select: none;
    pointer-events: none;
    
    /* Smooth font-rendering f√∂r LP156WH4 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
}

/* Sparkle-effekt f√∂r sn√∂flingor */
.snow-particle.sparkle {
    animation: snow-fall linear infinite, snow-sparkle 2s ease-in-out infinite;
}

/* Sn√∂-animationer */
@keyframes snow-fall {
    0% {
        transform: translateY(-20px) translateZ(0);
        opacity: 0;
    }
    
    10% {
        opacity: 0.85;
    }
    
    90% {
        opacity: 0.85;
    }
    
    100% {
        transform: translateY(100vh) translateZ(0);
        opacity: 0;
    }
}

@keyframes snow-sparkle {
    0%, 100% {
        filter: brightness(1.1) contrast(1.1) saturate(1);
    }
    
    50% {
        filter: brightness(1.4) contrast(1.3) saturate(1.2);
    }
}

/* === PERFORMANCE OPTIMERINGAR === */

/* GPU-acceleration f√∂r alla weather particles */
.rain-particle,
.snow-particle {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
}

/* Optimera animations f√∂r 60fps p√• Pi5 */
@media (hover: none) and (pointer: coarse) {
    /* Mobile/Touch devices (inklusive Pi5 touchscreen) */
    .rain-particle {
        animation-timing-function: linear;
        animation-fill-mode: both;
    }
    
    .snow-particle {
        animation-timing-function: linear;
        animation-fill-mode: both;
    }
}

/* Minska motion f√∂r anv√§ndare med reduced motion preference */
@media (prefers-reduced-motion: reduce) {
    .weather-effect-wrapper {
        animation: none;
        transition: none;
    }
    
    .rain-particle,
    .snow-particle {
        animation-duration: 5s !important; /* L√•ngsammare animationer */
        opacity: 0.5 !important; /* Mindre intensiva effekter */
    }
    
    .snow-particle.sparkle {
        animation: snow-fall linear infinite !important; /* Ta bort sparkle */
    }
}

/* === Z-INDEX KOMPATIBILITET MED DASHBOARD === */

/* S√§kerst√§ll att weather effects visas √∂ver allt inneh√•ll men under eventuella modaler */
.weather-effect-wrapper {
    z-index: 99999999 !important; /* √ñver glassmorphism cards (z-index ~1000) */
}

/* Om det finns loading overlay eller modaler med h√∂gre z-index */
.loading-overlay {
    z-index: 999999999 !important; /* √ñver weather effects om n√∂dv√§ndigt */
}

/* === THEME KOMPATIBILITET === */

/* Ljust tema - mindre intensiva effekter */
.theme-light .rain-particle {
    opacity: 0.7; /* üåßÔ∏è F√ñRB√ÑTTRAT: Lite h√∂gre √§n tidigare */
    background: linear-gradient(to bottom, 
        rgba(0, 170, 255, 0.8) 0%, /* üåßÔ∏è F√ñRB√ÑTTRAT: F√∂rst√§rkt */
        rgba(0, 170, 255, 0.6) 50%, 
        rgba(0, 170, 255, 0.2) 100%
    );
    /* üåßÔ∏è F√ñRB√ÑTTRAT: Beh√•ller glow-effekt √§ven i ljust tema */
    box-shadow: 
        0 0 2px rgba(0, 170, 255, 0.5),
        0 0 4px rgba(0, 170, 255, 0.25);
}

.theme-light .snow-particle {
    opacity: 0.7;
    color: #f0f0f0;
    text-shadow: 
        0 0 2px rgba(255, 255, 255, 0.6),
        0 0 4px rgba(255, 255, 255, 0.3);
}

/* M√∂rkt tema - mer intensiva effekter */
.theme-dark .rain-particle {
    opacity: 0.95; /* üåßÔ∏è F√ñRB√ÑTTRAT: Maximal synlighet i m√∂rkt tema */
    background: linear-gradient(to bottom, 
        rgba(0, 170, 255, 1) 0%, /* üåßÔ∏è F√ñRB√ÑTTRAT: Full intensitet */
        rgba(0, 170, 255, 0.9) 50%, 
        rgba(0, 170, 255, 0.4) 100%
    );
    filter: brightness(1.2) contrast(1.1);
    /* üåßÔ∏è F√ñRB√ÑTTRAT: Starkare glow i m√∂rkt tema */
    box-shadow: 
        0 0 3px rgba(0, 170, 255, 0.8),
        0 0 6px rgba(0, 170, 255, 0.4);
}

.theme-dark .snow-particle {
    opacity: 0.95;
    color: #ffffff;
    text-shadow: 
        0 0 4px rgba(255, 255, 255, 1),
        0 0 8px rgba(255, 255, 255, 0.6);
    filter: brightness(1.1) contrast(1.1);
}

/* === INTENSITY VARIATIONS === */

/* Light intensity - f√§rre partiklar, l√•ngsammare animationer */
.weather-effect-wrapper.intensity-light .rain-particle {
    opacity: 0.7; /* üåßÔ∏è F√ñRB√ÑTTRAT: H√∂jd fr√•n 0.6 */
    animation-duration: 3s;
    /* üåßÔ∏è F√ñRB√ÑTTRAT: Beh√•ller glow √§ven vid light intensity */
    box-shadow: 
        0 0 1px rgba(0, 170, 255, 0.4),
        0 0 2px rgba(0, 170, 255, 0.2);
}

.weather-effect-wrapper.intensity-light .snow-particle {
    opacity: 0.7;
    animation-duration: 4s;
}

/* Medium intensity - standard v√§rden (definierade ovan) */

/* Heavy intensity - fler partiklar, snabbare animationer */
.weather-effect-wrapper.intensity-heavy .rain-particle {
    opacity: 1; /* üåßÔ∏è F√ñRB√ÑTTRAT: Maximal synlighet */
    animation-duration: 1.5s;
    height: 22px; /* üåßÔ∏è F√ñRB√ÑTTRAT: √Ñnnu l√§ngre droppar vid heavy */
    width: 5px; /* üåßÔ∏è F√ñRB√ÑTTRAT: Bredare vid heavy intensity */
    /* üåßÔ∏è F√ñRB√ÑTTRAT: Stark glow f√∂r heavy rain */
    box-shadow: 
        0 0 4px rgba(0, 170, 255, 0.8),
        0 0 8px rgba(0, 170, 255, 0.4),
        0 0 12px rgba(0, 170, 255, 0.2);
}

.weather-effect-wrapper.intensity-heavy .snow-particle {
    opacity: 1;
    animation-duration: 2.5s;
    filter: brightness(1.2) contrast(1.2);
}

/* === UTILITY CLASSES === */

/* D√∂lj weather effects */
.weather-effect-wrapper.hidden {
    opacity: 0 !important;
    pointer-events: none !important;
}

/* Pausa animationer (f√∂r debugging) */
.weather-effect-wrapper.paused .rain-particle,
.weather-effect-wrapper.paused .snow-particle {
    animation-play-state: paused;
}

/* === DEBUG-STYLING (endast vid development) === */

.weather-effect-wrapper.debug {
    border: 2px dashed rgba(255, 0, 0, 0.5);
    background: rgba(255, 255, 0, 0.1);
}

.weather-effect-wrapper.debug .rain-particle {
    background: rgba(255, 0, 0, 0.8) !important;
}

.weather-effect-wrapper.debug .snow-particle {
    color: rgba(255, 0, 0, 0.8) !important;
    text-shadow: none !important;
}

/* === F√ñRB√ÑTTRAD CONTRAST F√ñR LED LCD PANEL === */

/* LP156WH4 √§r en LED LCD panel som kan ha l√§gre kontrast √§n OLED */
.rain-particle {
    /* üåßÔ∏è F√ñRB√ÑTTRAT: Extra kontrast-boost f√∂r LED panels */
    filter: brightness(1.15) contrast(1.1) saturate(1.2);
}

.snow-particle {
    /* Extra ljusstyrka f√∂r vit text p√• LED panels */
    filter: brightness(1.1) contrast(1.1);
    
    /* Starkare text-shadow f√∂r b√§ttre definition */
    text-shadow: 
        0 0 3px rgba(255, 255, 255, 0.9),
        0 0 6px rgba(255, 255, 255, 0.5),
        0 1px 0 rgba(255, 255, 255, 0.3);
}

/* === SMOOTH FADE TRANSITIONS === */

.weather-effect-wrapper {
    transition: opacity 1000ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* Smooth enter/exit transitions f√∂r partiklar */
.rain-particle,
.snow-particle {
    animation-fill-mode: both;
    animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* === FINAL OPTIMIZATIONS === */

/* F√∂rhindra scroll och layout shifts */
.weather-effect-wrapper {
    overflow: hidden;
    contain: layout style paint;
}

/* Optimera f√∂r Pi5 memory usage */
.rain-particle,
.snow-particle {
    contain: layout style;
    isolation: isolate;
}

/* Print media - d√∂lj weather effects */
@media print {
    .weather-effect-wrapper {
        display: none !important;
    }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .rain-particle {
        background: linear-gradient(to bottom, 
            rgba(0, 150, 255, 1) 0%, 
            rgba(0, 150, 255, 0.9) 50%, 
            transparent 100%
        );
        filter: brightness(1.3) contrast(1.3);
        /* üåßÔ∏è F√ñRB√ÑTTRAT: Maximal glow f√∂r high contrast */
        box-shadow: 
            0 0 5px rgba(0, 150, 255, 1),
            0 0 10px rgba(0, 150, 255, 0.6);
    }
    
    .snow-particle {
        color: #ffffff;
        filter: brightness(1.3) contrast(1.3);
        text-shadow: 
            0 0 2px rgba(255, 255, 255, 1),
            0 0 4px rgba(255, 255, 255, 0.8);
    }
}

/* Accessibility: Respektera user preferences */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    .weather-effect-wrapper {
        display: none;
    }
}

console.log('[WeatherEffects] CSS-animationer laddade - LP156WH4 optimerade med f√∂rb√§ttrade regndroppar');